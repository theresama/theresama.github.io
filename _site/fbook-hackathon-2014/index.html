<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width,maximum-scale = 1.0" />
    <meta name="keywords" content="">
    <meta name="author" content="Theresa Ma">
    <meta name="copyright" content="Theresa Ma">
    <meta name="robots" content="index, follow">
    <meta http-equiv="content-type" content="text/html;UTF-8">
    <meta http-equiv="cache-control" content="cache">
    <meta http-equiv="content-language" content="en">

    <link rel="icon" type="image/png" href="/assets/images/favicon.ico">

    <meta name="description" content="Aspiring software engineer dabbling in design; computer & cognitive science student at the University of Toronto.">

    <title>Facebook Hackathon 2014</title>
    <meta name="description" content="Aspiring software engineer dabbling in design; computer & cognitive science student at the University of Toronto.
">

    <link rel="icon" type="image/png" href="/assets/images/favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/main.css">

    <link rel="canonical" href="http://theresa-ma.com/fbook-hackathon-2014">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43805631-1', 'auto');
      ga('send', 'pageview');

      /* Modernizr 2.8.3 (Custom Build) | MIT & BSD
       * Build: http://modernizr.com/download/#-fontface-backgroundsize-borderradius-boxshadow-flexbox-flexboxlegacy-opacity-rgba-cssanimations-generatedcontent-cssgradients-csstransitions-shiv-cssclasses-teststyles-testprop-testallprops-prefixes-domprefixes-load
       */
      ;window.Modernizr=function(a,b,c){function A(a){j.cssText=a}function B(a,b){return A(n.join(a+";")+(b||""))}function C(a,b){return typeof a===b}function D(a,b){return!!~(""+a).indexOf(b)}function E(a,b){for(var d in a){var e=a[d];if(!D(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function F(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:C(f,"function")?f.bind(d||b):f}return!1}function G(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+p.join(d+" ")+d).split(" ");return C(b,"string")||C(b,"undefined")?E(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),F(e,b,c))}var d="2.8.3",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k,l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={},s={},t={},u=[],v=u.slice,w,x=function(a,c,d,e){var f,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},y={}.hasOwnProperty,z;!C(y,"undefined")&&!C(y.call,"undefined")?z=function(a,b){return y.call(a,b)}:z=function(a,b){return b in a&&C(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=v.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(v.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(v.call(arguments)))};return e}),r.flexbox=function(){return G("flexWrap")},r.flexboxlegacy=function(){return G("boxDirection")},r.rgba=function(){return A("background-color:rgba(150,255,150,.5)"),D(j.backgroundColor,"rgba")},r.backgroundsize=function(){return G("backgroundSize")},r.borderradius=function(){return G("borderRadius")},r.boxshadow=function(){return G("boxShadow")},r.opacity=function(){return B("opacity:.55"),/^0.55$/.test(j.opacity)},r.cssanimations=function(){return G("animationName")},r.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return A((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),D(j.backgroundImage,"gradient")},r.csstransitions=function(){return G("transition")},r.fontface=function(){var a;return x('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&g.indexOf(d.split(" ")[0])===0}),a},r.generatedcontent=function(){var a;return x(["#",h,"{font:0/0 a}#",h,':after{content:"',l,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a};for(var H in r)z(r,H)&&(w=H.toLowerCase(),e[w]=r[H](),u.push((e[w]?"":"no-")+w));return e.addTest=function(a,b){if(typeof a=="object")for(var d in a)z(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},A(""),i=k=null,function(a,b){function l(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function m(){var a=s.elements;return typeof a=="string"?a.split(" "):a}function n(a){var b=j[a[h]];return b||(b={},i++,a[h]=i,j[i]=b),b}function o(a,c,d){c||(c=b);if(k)return c.createElement(a);d||(d=n(c));var g;return d.cache[a]?g=d.cache[a].cloneNode():f.test(a)?g=(d.cache[a]=d.createElem(a)).cloneNode():g=d.createElem(a),g.canHaveChildren&&!e.test(a)&&!g.tagUrn?d.frag.appendChild(g):g}function p(a,c){a||(a=b);if(k)return a.createDocumentFragment();c=c||n(a);var d=c.frag.cloneNode(),e=0,f=m(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function q(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?o(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+m().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function r(a){a||(a=b);var c=n(a);return s.shivCSS&&!g&&!c.hasCSS&&(c.hasCSS=!!l(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||q(a,c),a}var c="3.7.0",d=a.html5||{},e=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g,h="_html5shiv",i=0,j={},k;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",g="hidden"in a,k=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){g=!0,k=!0}})();var s={elements:d.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:c,shivCSS:d.shivCSS!==!1,supportsUnknownElements:k,shivMethods:d.shivMethods!==!1,type:"default",shivDocument:r,createElement:o,createDocumentFragment:p};a.html5=s,r(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.testProp=function(a){return E([a])},e.testAllProps=G,e.testStyles=x,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+u.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};

    </script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper nav-border">

    <a class="site-title" href="/">theresa ma</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        <!-- 
          
        
          
         -->
        <a class="page-link" href="/">Home</a>
        <a class="page-link" href="/blog">Projects/Blog</a>
      </div>
    </nav>

  </div>

</header>


    <main style="width: 95%; margin: auto; float: right; margin-top: 56px;">
      <div class="row min-h" style="min-height: 75%;">
        <div class="page-content" >
          <div>
            <div class="post-wrap">
              <div class="post">

  <header class="post-header">
  	<a href="/blog" class="link-back">
  		<i class="fa fa-arrow-left"></i> 
  		Back to posts
  	</a>
    <h1 class="post-title">Facebook Hackathon 2014</h1>
    <a href="" target="_parent">
    	<p class="post-meta">Jan 24, 2013</p>
    </a>
  </header>

  <article class="post-content">
    <p>My partner (Ryan Lam) and I hacked together&nbsp;<strong><a href="http://theresa-ma.com/filter/">#filter: a Chrome Extension for Facebook</a>.&nbsp;</strong></p>
<p>I'm sure everyone reading this is decent enough not to ever need a "filter", but the idea was, it would filter your posts and comments before allowing you to post something it detects as ~potentially unkind~. A pretty simple idea.</p>
<p>Finished code is only 63 lines - so why'd it take almost 17 hours?&nbsp;</p>
<p>We started the hackathon with no idea as to how to write a Chrome Extension; we spent the first couple hours reading up on how it worked and fiddling around with demo extensions. Next step was planning out the functions and writing the Javascript.</p>
<p><strong>Basically four functions to it:</strong></p>
<ol>
<li>getting the button click action of "Post" or the enter keystroke for comments</li>
<li>getting the message that was typed in</li>
<li>using regex to match phrases</li>
<li>popping an alert on matched regex phrases</li>
</ol>
<p><strong>Getting the "Post" button</strong> - We inspected the element to find&nbsp;</p>
<pre><code>&lt;button value="1" class="_42ft _42fu _11b selected _42g-" type="submit"&gt;
     ::before
     "Post"
&lt;/button&gt;<br /></code></pre>
<p>Talking to one of the Facebook engineers, Owen (most helpful guy ever - thanks Owen!), he suggested that we instead grab it using&nbsp;</p>
<pre><code>document.querySelectorAll('button[value="1"][type="submit"]')[0]</code></pre>
<p>Cool! From there, we added an event listener to handle the click to trigger the rest of the functions and prevent the default posting action.</p>
<p>At first, we considered removing the "Post" button and substituting our own button that looked identical but had a different functionality. We realized that was unnecessary, but it could be a pretty fun trick as a handy prank. If you want to try that out, it's:</p>
<pre><code>element = document.querySelectorAll('button[value="1"][type="submit"]')[0]<br />parent = element.parentNode<br />newButton = document.createElement('button')<br />newButton.textContent = 'Post'<br />parent.appendChild(newButton)<br />element.remove()<br />newButton.className = '_42ft _42fu _11b selected _42g'<br />newButton.type = "submit"<br /></code></pre>
<p><strong>Getting your post/comment</strong>&nbsp;</p>
<p>Inspecting the text area, you can see that the body of your post can be grabbed with</p>
<pre><code>document.querySelectorAll('input[name="xhpc_message"]')[0].value</code></pre>
<p>So once the "Post" button is clicked, the value is then passed to our filter. For comments, it was trickier to figure out. Every comment is in a text area called&nbsp;</p>
<pre><code>add_comment_text_text</code></pre>
<p>but using the name returns a whole array of comments, indexed in order. How are we gonna get your current comment???? Well, if you're currently typing your comment, and you're going to hit "enter", I should be able to access your particular comment box by calling activeElement! That's what we ended up doing - adding an event listener for the "enter" key on the activeElement and getting the input as activeElement.value upon keydown.</p>
<p><strong>Matching your phrases w/regex</strong></p>
<p>We searched for potentially offensive phrases in a totally juvenile way - matching an array of regular expressions! There must be a more elegant way of doing it, (what kind of research is currently going on in semantic parsing?), but our simple "hack" just matches common expletives and derogatory phrases. The method returns true if matched.</p>
<p><strong>Popping an alert</strong></p>
<p>If the previous step returned true, we prevent the default, stop the propagation, and ask whether you really want to make that post. If you do, click OK and it'll post - otherwise, it gives you a chance for revision!&nbsp;<strong><br /></strong></p>
<p><strong>Unexpected Issue:</strong></p>
<p>We were running into a problem where the script wouldn't run unless the page were manually refreshed. If you click from one page on Facebook to the next - for example, going from the homepage to your profile, the script wouldn't run again.</p>
<p>We asked the Facebook engineers about it and&nbsp;it turns out, Facebook doesn't reload the page (it makes multiple AJAX calls). Uh oh! We found the problem on <a href="http://stackoverflow.com/questions/9982429/chrome-extension-which-is-supposed-to-run-on-all-facebook-pages-only-runs-when-i">StackOverflow</a>&nbsp;with a possible solution of "hijacking&nbsp;<span>XMLHttpRequest" - what??</span>&nbsp;</p>
<p>There's gotta be another way! Our solution - ah, we wrapped our functions in setInterval(), causing them to be run continuously! Possibly not the most elegant solution, but it's simple and it works.</p>
<p><strong>Wrapping it up:</strong></p>
<p>It currently works on posting from the news feed, posting from your timeline, and any comment area on any page (anywhere except on a friend's timeline and private messages).&nbsp;</p>
<p>Even though it was a pretty basic hack, it still felt like an accomplishment to have it working. Threw up a quick GitHub Pages for it, and we were ready to demo (shout out to <a href="http://www.linkedin.com/pub/theresa-shim/6a/a6b/ab9">Theresa Shim</a> for writing our blurb - by that point we were too tired to string words into anything coherent).&nbsp;</p>
<p>Hurrah; so that's my first Chrome Extension. You can get it all in a pretty little package <strong><a href="http://theresa-ma.com/filter/">here</a>.&nbsp;</strong>&nbsp;</p>


  </article>
  <a href="/blog" class="link-back">
  	<i class="fa fa-arrow-left"></i> 
  	Back to posts
  </a>

</div>

            </div>
          </div>
        </div>
      </div>
      <footer class="site-footer">

  <span class="footer-social">
    <a href="mailto:theresa.ma@mail.utoronto.ca" target="_parent"><i class="fa fa-envelope-o"></i></a>
    <a href="//twitter.com/theresamatweets" target="_parent"><i class="fa fa-twitter"></i></a>
    <a href="//www.linkedin.com/in/matheresa" target="_parent"><i class="fa fa-linkedin"></i></a>
    <a href="//github.com/theresama" target="_parent"><i class="fa fa-github"></i></a>
  </span>

</footer>

    </main>

    

    <script>
      $(function(){
        var height = $(window).height();

        $('.min-h').css('min-height', height - 190);

      })


    </script>

  </body>

</html>
